<!DOCTYPE html>
<html>
    
<head>
    <title>lyricDisplay</title>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="./lynda.png" />
    <style>
        @font-face {
           font-family: 'Noto Sans TC';
           font-style: normal;
           font-weight: 500;
           src: url(//fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Medium.woff2) format('woff2'),
                url(//fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Medium.woff) format('woff'),
                url(//fonts.gstatic.com/ea/notosanstc/v1/NotoSansTC-Medium.otf) format('opentype');
         }
    </style>
</head>

<body style=" background:black;color:white; margin:0px; ">
    <div id = "progress" style=" height: 5px; width: 10%; background-color:goldenrod; "></div>
    <div style="width:100%;">
        <span id = "lastSong" style="display:inline-block; text-align:center; color: #555555; width:33%">last song name</span>
        <span id = "currentSong" style="display:inline-block; text-align:center; color: #555555; width:33%">current song name</span>
        <span id = "nextSong" style="display:inline-block; text-align:center; color: #555555; width:33%">next song name</span>
    </div>
    <h1 style=" text-align:center; font-size:60px; margin:0; font-family: 'Helvetica'">===NTU Musical 106-2 Lyrics===</h1>
    <h2 style=" text-align:center; font-size:50px; margin:0; font-family: 'Noto Sans TC'">===台大音樂劇社 106-2 歌詞===</h2>
    <div id='fileNames'></div>
</body>

<script src="https://code.jquery.com/jquery-1.12.4.js"></script>

<script>

    var dirName = 'https://raw.githubusercontent.com/lynda0214/lyricDisplay/master/lyrics/';
    var fileNames = [escape('1 Hasa Diga Eebowai.txt'), escape('2 Take Me or Leave Me.txt')]; // TODO: Add Lyrics Here
    var fileNamesComplete = [];
    for (var i = 0; i < fileNames.length; i++) {
        fileNamesComplete.push(dirName.concat(fileNames[i]));
    }
    
    var arr = [];
    var totalLines = 0;
    $.each(fileNamesComplete, function(i, file){
        $.get(file, function(s) {
            console.log(s);
            arr[i] = s.split('\n');    
            totalLines += arr[i].length-1;
        });
    });

    var fileIndex = 0; 
    var lyricIndex = -1;
    var enzh;
    var songName;

    $(document).keydown(function(event) {
        var keycode = event.keyCode;

        if (keycode == 37) { // left (last line of lyric)
            if (lyricIndex > 0) lyricIndex--;
            updateText();
        } else if (keycode == 39) { // right (next line of lyric)
            if (lyricIndex < arr[fileIndex].length - 2) lyricIndex++; // cause there's always a line change automatically added to the last line
            updateText();
        } else if (keycode == 38) { // up (last song) 
            if (fileIndex > 0) fileIndex--; 
            lyricIndex = 0;
            updateText();
        } else if (keycode == 40) { // down (next song)
            if (fileIndex < fileNames.length - 1) fileIndex++;
            lyricIndex = 0;
            updateText();
        } else if (keycode == 32) { // space (blank page)
            $('h1').toggle();
            $('h2').toggle();
        } 


        var currentLines = 0;
        for (var i = 0; i < fileIndex; i++) {
            currentLines += arr[i].length;
        }
        currentLines += (lyricIndex);
        console.log(currentLines);
        document.getElementById('progress').style.width = (currentLines / totalLines)*100 + '%';        

    });

    function updateText() {
        enzh = arr[fileIndex][lyricIndex].split('/');
        $('h1').text(enzh[0]);
        $('h2').text(enzh[1]);

        if (fileIndex-1 >= 0) {
            songName = fileNames[fileIndex-1].split('.');
            $('#lastSong').text("Last: "+unescape(songName[0]));
        } else {
            $('#lastSong').text("Last: N/A");
        }       
        songName = fileNames[fileIndex].split('.');
        $('#currentSong').text(unescape(songName[0]));

        if (fileIndex+1 < fileIndex.length) {
            songName = fileNames[fileIndex+1].split('.');
            $('#nextSong').text("Next: "+unescape(songName[0]));
        } else {
            $('#nextSong').text("Next: N/A");
        }
    }

</script>

</html>
